
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../2_AutomaticVariantC/" rel="prev"/>
<link href="../4_IntroductiontoHPC/" rel="next"/>
<link href="../nesi_images/nesi_ga.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.0.11" name="generator"/>
<title>RNA-seq Mapping And Count Data Workflow - Introduction to Bash Scripting and HPC Scheduler</title>
<link href="../assets/stylesheets/main.0d440cfe.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.2505c338.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Mukta:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Mukta";--md-code-font:"Roboto Mono"}</style>
<link href="../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="teal" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#rna-seq-mapping-and-count-data-workflow">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Introduction to Bash Scripting and HPC Scheduler" class="md-header__button md-logo" data-md-component="logo" href=".." title="Introduction to Bash Scripting and HPC Scheduler">
<img alt="logo" src="../nesi_images/nesi_ga.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Introduction to Bash Scripting and HPC Scheduler
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              RNA-seq Mapping And Count Data Workflow
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="teal" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_3" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="teal" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to system preference" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="teal" data-md-color-scheme="slate" id="__palette_3" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to system preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/GenomicsAotearoa/Workshop-Bash_Scripting_And_HPC_Job_Scheduler.git" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GenomicsAotearoa/Workshop-Bash_Scripting_And_HPC_Job_Scheduler
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Introduction to Bash Scripting and HPC Scheduler" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Introduction to Bash Scripting and HPC Scheduler">
<img alt="logo" src="../nesi_images/nesi_ga.png"/>
</a>
    Introduction to Bash Scripting and HPC Scheduler
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/GenomicsAotearoa/Workshop-Bash_Scripting_And_HPC_Job_Scheduler.git" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GenomicsAotearoa/Workshop-Bash_Scripting_And_HPC_Job_Scheduler
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../1_DesigningVariantC/">
        Variant Calling Workflow
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../2_AutomaticVariantC/">
        Automating a Variant Calling Workflow
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          RNA-seq Mapping And Count Data Workflow
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        RNA-seq Mapping And Count Data Workflow
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#assumptions">
    Assumptions
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#alignment-to-a-reference-genome">
    Alignment to a reference genome
  </a>
<nav aria-label="Alignment to a reference genome" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#preparation-of-the-genome">
    Preparation of the genome
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#alignment-on-the-genome">
    Alignment on the genome
  </a>
<nav aria-label="Alignment on the genome" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#converting-sam-files-to-bam-files">
    Converting SAM files to BAM files
  </a>
<nav aria-label="Converting SAM files to BAM files" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#a-quick-look-into-the-sam-file">
    A quick look into the sam file
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#some-stats-on-your-mapping">
    Some stats on your mapping:
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#read-summarization">
    Read Summarization
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#counting">
    Counting
  </a>
<nav aria-label="Counting" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#subread-and-featurecounts">
    Subread and FeatureCounts
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#group-exercise">
    Group Exercise
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../4_IntroductiontoHPC/">
        Introduction to HPC
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../5_working_with_job_scheduler/">
        Working with job scheduler
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../6_supplementary_1/">
        S1 : Accessing software via modules
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../7_supplementary_2/">
        S2 : slurm profiling
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../8_supplementary_3/">
        S3 : Solutions
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#assumptions">
    Assumptions
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#alignment-to-a-reference-genome">
    Alignment to a reference genome
  </a>
<nav aria-label="Alignment to a reference genome" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#preparation-of-the-genome">
    Preparation of the genome
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#alignment-on-the-genome">
    Alignment on the genome
  </a>
<nav aria-label="Alignment on the genome" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#converting-sam-files-to-bam-files">
    Converting SAM files to BAM files
  </a>
<nav aria-label="Converting SAM files to BAM files" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#a-quick-look-into-the-sam-file">
    A quick look into the sam file
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#some-stats-on-your-mapping">
    Some stats on your mapping:
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#read-summarization">
    Read Summarization
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#counting">
    Counting
  </a>
<nav aria-label="Counting" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#subread-and-featurecounts">
    Subread and FeatureCounts
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#group-exercise">
    Group Exercise
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="rna-seq-mapping-and-count-data-workflow">RNA-seq Mapping And Count Data Workflow<a class="headerlink" href="#rna-seq-mapping-and-count-data-workflow" title="Permanent link">¶</a></h1>
<p>This material is extracted from the <a href="https://github.com/GenomicsAotearoa/RNA-seq-workshop">RNA-seq workshop</a> Lesson</p>
<div class="admonition abstract">
<p class="admonition-title">Objectives and overall workflow</p>
<ul>
<li>To develop a pipeline that does mapping and count the number of reads that mapped then overall put all these steps into a script.</li>
<li>Understand and perform the steps involved in RNA-seq mapping and read count.</li>
<li>Use command line tools to run the pipeline.</li>
</ul>
</div>
<p><center>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../nesi_images/rnaseq_workflowdiagram.png"><img alt="image" src="../nesi_images/rnaseq_workflowdiagram.png"/></a>
</center></p>
<h3 id="assumptions">Assumptions<a class="headerlink" href="#assumptions" title="Permanent link">¶</a></h3>
<ul>
<li>You have already performed trimming and filtering of your reads and saved in a directory called trimmed_reads.</li>
<li>You have a reference genome saved in a directory called ref_genome.</li>
</ul>
<p>In this workshop, we have already trimmed the reads and downloaded the reference genome for you.
First, it is always good to verify where we are:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/scripting_workshop
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>$<span class="w"> </span><span class="nb">pwd</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>/home/<span class="o">[</span>your_username<span class="o">]</span>/scripting_workshop
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="c1"># good I am ready to work</span>
</code></pre></div>
<p>Checking to make sure we have the directory and files for the workshop.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>$<span class="w"> </span>ls
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>rna_seq<span class="w">  </span>variant_calling<span class="w"> </span>scheduler
</code></pre></div>
<blockquote>
<p>hint : If you do not have the workshop directory, you can copy it using the command: <code>cp -r  /nesi/project/nesi02659/scripting_workshop/ ~</code> </p>
</blockquote>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>rna_seq
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>$<span class="w"> </span>ls
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>ref_genome<span class="w">  </span>trimmed_reads<span class="w"> </span>
</code></pre></div>
<h2 id="alignment-to-a-reference-genome">Alignment to a reference genome<a class="headerlink" href="#alignment-to-a-reference-genome" title="Permanent link">¶</a></h2>
<p>RNA-seq generate gene expression information by quantifying the number of transcripts (per gene) in a sample. This is acompished by counting the number of transcripts that have been sequenced - the more active a gene is, the more transcripts will be in a sample, and the more reads will be generated from that transcript.</p>
<p>For RNA-seq, we need to align or map each read back to the genome, to see which gene produced it.
- Highly expressed genes will generate lots of transcripts, so there will be lots of reads that map back to the position of that transcript in the genome.
- The per-gene data we work with in an RNA-seq experiment are counts: the number of reads from each sample that originated from that gene.</p>
<h3 id="preparation-of-the-genome">Preparation of the genome<a class="headerlink" href="#preparation-of-the-genome" title="Permanent link">¶</a></h3>
<p>To be able to map (align) sequencing reads on the genome, the genome needs to be indexed first. In this workshop we will use <a href="https://www.nature.com/articles/nmeth.3317">HISAT2</a>.</p>
<div class="admonition terminal">
<p class="admonition-title">script</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/scripting_workshop/rna_seq/ref_genome
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="c1">#to list what is in your directory:</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>$<span class="w"> </span>ls<span class="w"> </span>~/scripting_workshop/rna_seq/ref_genome
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>Saccharomyces_cerevisiae.R64-1-1.99.gtf<span class="w">  </span>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.fa
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>$<span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>HISAT2/2.2.0-gimkl-2020a
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="c1"># index file:</span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>$<span class="w"> </span>hisat2-build<span class="w"> </span>-p<span class="w"> </span><span class="m">4</span><span class="w"> </span>-f<span class="w"> </span>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.fa<span class="w"> </span>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="c1">#list what is in the directory:</span>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>$<span class="w"> </span>ls<span class="w"> </span>~/scripting_workshop/rna_seq/ref_genome
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a>Saccharomyces_cerevisiae.R64-1-1.99.gtf<span class="w">              </span>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.4.ht2<span class="w">  </span>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.8.ht2
<a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.1.ht2<span class="w">  </span>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.5.ht2<span class="w">  </span>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.fa
<a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.2.ht2<span class="w">  </span>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.6.ht2
<a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.3.ht2<span class="w">  </span>Saccharomyces_cerevisiae.R64-1-1.dna.toplevel.7.ht2<span class="w">   </span>
</code></pre></div>
</div>
<blockquote>
<p><strong>Arguments:</strong>
 * <strong>-p</strong> number of threads
 * <strong>-f</strong> fasta file</p>
</blockquote>
<p>How many files were created during the indexing process?</p>
<h2 id="alignment-on-the-genome">Alignment on the genome<a class="headerlink" href="#alignment-on-the-genome" title="Permanent link">¶</a></h2>
<p>Now that the genome is prepared. Sequencing reads can be aligned.</p>
<p>Information required:</p>
<ul>
<li>Where the sequence information is stored (e.g. fastq files ...) ?</li>
<li>What kind of sequencing: Single End or Paired end ?</li>
<li>Where are stored the indexes and the genome? </li>
<li>
<p>Where will the mapping files be stored?</p>
</li>
<li>
<p>Now, lets move one folder up (into the rna_seq folder):</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>$<span class="w"> </span>ls
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>ref_genome<span class="w">  </span>trimmed_reads
</code></pre></div>
<p>Let's map one of our sample to the reference genome</p>
<div class="admonition terminal">
<p class="admonition-title">script</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>$<span class="w"> </span><span class="nb">pwd</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>/home/<span class="o">[</span>Your_Username<span class="o">]</span>/scripting_workshop/rna_seq/
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>$<span class="w"> </span>mkdir<span class="w"> </span>Mapping
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>$<span class="w"> </span>ls
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>ref_genome<span class="w">  </span>Mapping<span class="w">  </span>trimmed_reads
</code></pre></div>
</div>
<p>let's use a for loop to process our samples:</p>
<div class="admonition terminal">
<p class="admonition-title">script</p>
<p><div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>trimmed_reads
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>$<span class="w"> </span>ls
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>SRR014335-chr1.fastq<span class="w">  </span>SRR014336-chr1.fastq<span class="w">  </span>SRR014337-chr1.fastq<span class="w">  </span>SRR014339-chr1.fastq<span class="w">  </span>SRR014340-chr1.fastq<span class="w">  </span>SRR014341-chr1.fastq
</code></pre></div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>*
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w"> </span><span class="k">do</span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w"> </span><span class="nv">base</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">filename</span><span class="si">}</span><span class="w"> </span>.fastq<span class="k">)</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w"> </span>hisat2<span class="w"> </span>-p<span class="w"> </span><span class="m">4</span><span class="w"> </span>-x<span class="w"> </span>../ref_genome/Saccharomyces_cerevisiae.R64-1-1.dna.toplevel<span class="w"> </span>-U<span class="w"> </span><span class="nv">$filename</span><span class="w"> </span>-S<span class="w"> </span>../Mapping/<span class="si">${</span><span class="nv">base</span><span class="si">}</span>.sam<span class="w"> </span>--summary-file<span class="w"> </span>../Mapping/<span class="si">${</span><span class="nv">base</span><span class="si">}</span>_summary.txt
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="k">done</span>
</code></pre></div></p>
</div>
<blockquote>
<p><strong>Arguments:</strong>
 * <strong>-x</strong> The basename of the index for the reference genome. 
 * <strong>-U</strong> Comma-separated list of files containing unpaired reads to be aligned
 * <strong>-S</strong> File to write SAM alignments to. By default, alignments are written to the “standard out” or “stdout” filehandle  </p>
</blockquote>
<p>Now we can explore our SAM files.</p>
<div class="admonition terminal">
<p class="admonition-title">script</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>../Mapping
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>$<span class="w"> </span>ls
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>SRR014335-chr1.sam<span class="w">          </span>SRR014336-chr1_summary.txt<span class="w">  </span>SRR014339-chr1.sam<span class="w">          </span>SRR014340-chr1_summary.txt
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>SRR014335-chr1_summary.txt<span class="w">  </span>SRR014337-chr1.sam<span class="w">          </span>SRR014339-chr1_summary.txt<span class="w">  </span>SRR014341-chr1.sam
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>SRR014336-chr1.sam<span class="w">          </span>SRR014337-chr1_summary.txt<span class="w">  </span>SRR014340-chr1.sam<span class="w">          </span>SRR014341-chr1_summary.txt
</code></pre></div>
</div>
<h3 id="converting-sam-files-to-bam-files">Converting SAM files to BAM files<a class="headerlink" href="#converting-sam-files-to-bam-files" title="Permanent link">¶</a></h3>
<p>The SAM file, is a tab-delimited text file that contains information for each individual read and its alignment to the genome. While we do not have time to go into detail about the features of the SAM format, the paper by Heng Li et al. provides a lot more detail on the specification.</p>
<p>The compressed binary version of SAM is called a BAM file. We use this version to reduce size and to allow for indexing, which enables efficient random access of the data contained within the file.</p>
<h4 id="a-quick-look-into-the-sam-file">A quick look into the sam file<a class="headerlink" href="#a-quick-look-into-the-sam-file" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>$<span class="w"> </span>less<span class="w"> </span>SRR014335-chr1.sam<span class="w"> </span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>The<span class="w"> </span>file<span class="w"> </span>begins<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>header,<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>optional.<span class="w"> </span>The<span class="w"> </span>header<span class="w"> </span>is<span class="w"> </span>used<span class="w"> </span>to<span class="w"> </span>describe<span class="w"> </span>the<span class="w"> </span><span class="nb">source</span><span class="w"> </span>of<span class="w"> </span>data,<span class="w"> </span>reference<span class="w"> </span>sequence,<span class="w"> </span>method<span class="w"> </span>of<span class="w"> </span>alignment,<span class="w"> </span>etc.,<span class="w"> </span>this<span class="w"> </span>will<span class="w"> </span>change<span class="w"> </span>depending<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>aligner<span class="w"> </span>being<span class="w"> </span>used.<span class="w"> </span>Following<span class="w"> </span>the<span class="w"> </span>header<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>alignment<span class="w"> </span>section.<span class="w"> </span>Each<span class="w"> </span>line<span class="w"> </span>that<span class="w"> </span>follows<span class="w"> </span>corresponds<span class="w"> </span>to<span class="w"> </span>alignment<span class="w"> </span>information<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>read.<span class="w"> </span>Each<span class="w"> </span>alignment<span class="w"> </span>line<span class="w"> </span>has<span class="w"> </span><span class="m">11</span><span class="w"> </span>mandatory<span class="w"> </span>fields<span class="w"> </span><span class="k">for</span><span class="w"> </span>essential<span class="w"> </span>mapping<span class="w"> </span>information<span class="w"> </span>and<span class="w"> </span>a<span class="w"> </span>variable<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>other<span class="w"> </span>fields<span class="w"> </span><span class="k">for</span><span class="w"> </span>aligner<span class="w"> </span>specific<span class="w"> </span>information.<span class="w"> </span>An<span class="w"> </span>example<span class="w"> </span>entry<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>SAM<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span>displayed<span class="w"> </span>below<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>different<span class="w"> </span>fields<span class="w"> </span>highlighted.
</code></pre></div>
<p>We will convert the SAM file to BAM format using the samtools program with the view command and tell this command that the input is in SAM format (<code>-S</code>) and to output BAM format (<code>-b</code>):</p>
<div class="admonition terminal">
<p class="admonition-title">script</p>
<p><div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>module<span class="w"> </span>load<span class="w"> </span>SAMtools/1.10-GCC-9.2.0
</code></pre></div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.sam
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w"> </span><span class="k">do</span>
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w"> </span><span class="nv">base</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">filename</span><span class="si">}</span><span class="w"> </span>.sam<span class="k">)</span>
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w"> </span>samtools<span class="w"> </span>view<span class="w"> </span>-S<span class="w"> </span>-b<span class="w"> </span><span class="si">${</span><span class="nv">filename</span><span class="si">}</span><span class="w"> </span>-o<span class="w"> </span><span class="si">${</span><span class="nv">base</span><span class="si">}</span>.bam
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="k">done</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>$<span class="w"> </span>ls
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>SRR014335-chr1.bam<span class="w">  </span>SRR014336-chr1.bam<span class="w">  </span>SRR014337-chr1.bam<span class="w">  </span>SRR014339-chr1.bam<span class="w">  </span>SRR014340-chr1.bam<span class="w">  </span>SRR014341-chr1.bam
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>SRR014335-chr1.sam<span class="w">  </span>SRR014336-chr1.sam<span class="w">  </span>SRR014337-chr1.sam<span class="w">  </span>SRR014339-chr1.sam<span class="w">  </span>SRR014340-chr1.sam<span class="w">  </span>SRR014341-chr1.sam
</code></pre></div></p>
</div>
<p>Next we sort the BAM file using the sort command from samtools. <code>-o</code> tells the command where to write the output.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SAM/BAM files can be sorted in multiple ways, e.g. by location of alignment on the chromosome, by read name, etc. It is important to be aware that different alignment tools will output differently sorted SAM/BAM, and different downstream tools require differently sorted alignment files as input.**</p>
</div>
<div class="admonition terminal">
<p class="admonition-title">script</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.bam
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w"> </span><span class="k">do</span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w"> </span><span class="nv">base</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">filename</span><span class="si">}</span><span class="w"> </span>.bam<span class="k">)</span>
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w"> </span>samtools<span class="w"> </span>sort<span class="w"> </span>-o<span class="w"> </span><span class="si">${</span><span class="nv">base</span><span class="si">}</span>_sorted.bam<span class="w"> </span><span class="si">${</span><span class="nv">filename</span><span class="si">}</span>
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="k">done</span>
</code></pre></div>
</div>
<p>We can use samtools to learn more about the bam file as well.</p>
<h4 id="some-stats-on-your-mapping">Some stats on your mapping:<a class="headerlink" href="#some-stats-on-your-mapping" title="Permanent link">¶</a></h4>
<div class="admonition terminal">
<p class="admonition-title">script</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a>$<span class="w"> </span>samtools<span class="w"> </span>flagstat<span class="w"> </span>SRR014335-chr1_sorted.bam<span class="w"> </span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="m">156984</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>total<span class="w"> </span><span class="o">(</span>QC-passed<span class="w"> </span>reads<span class="w"> </span>+<span class="w"> </span>QC-failed<span class="w"> </span>reads<span class="o">)</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="m">31894</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>secondary
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>supplementary
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>duplicates
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="m">136447</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>mapped<span class="w"> </span><span class="o">(</span><span class="m">86</span>.92%<span class="w"> </span>:<span class="w"> </span>N/A<span class="o">)</span>
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>paired<span class="w"> </span><span class="k">in</span><span class="w"> </span>sequencing
<a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>read1
<a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>read2
<a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>properly<span class="w"> </span>paired<span class="w"> </span><span class="o">(</span>N/A<span class="w"> </span>:<span class="w"> </span>N/A<span class="o">)</span>
<a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>with<span class="w"> </span>itself<span class="w"> </span>and<span class="w"> </span>mate<span class="w"> </span>mapped
<a href="#__codelineno-14-13" id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>singletons<span class="w"> </span><span class="o">(</span>N/A<span class="w"> </span>:<span class="w"> </span>N/A<span class="o">)</span>
<a href="#__codelineno-14-14" id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>with<span class="w"> </span>mate<span class="w"> </span>mapped<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>different<span class="w"> </span>chr
<a href="#__codelineno-14-15" id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="m">0</span><span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>with<span class="w"> </span>mate<span class="w"> </span>mapped<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>different<span class="w"> </span>chr<span class="w"> </span><span class="o">(</span>mapQ&gt;<span class="o">=</span><span class="m">5</span><span class="o">)</span>
</code></pre></div>
</div>
<hr/>
<h2 id="read-summarization">Read Summarization<a class="headerlink" href="#read-summarization" title="Permanent link">¶</a></h2>
<p>Sequencing reads often need to be assigned to genomic features of interest after they are mapped to the reference genome. This process is often called read summarization or read quantification. Read summarization is required by a number of downstream analyses such as gene expression analysis and histone modification analysis. The output of read summarization
is a count table, in which the number of reads assigned to each feature in each library is recorded.</p>
<h2 id="counting">Counting<a class="headerlink" href="#counting" title="Permanent link">¶</a></h2>
<ul>
<li>We need to do some counting!</li>
<li>Want to generate count data for each gene (actually each exon) - how many reads mapped to each exon in the genome, from each of our samples?</li>
<li>Once we have that information, we can start thinking about how to determine which genes were differentially expressed in our study.</li>
</ul>
<h3 id="subread-and-featurecounts">Subread and FeatureCounts<a class="headerlink" href="#subread-and-featurecounts" title="Permanent link">¶</a></h3>
<ul>
<li>The featureCounts tool from the Subread package can be used to count how many reads aligned to each genome feature (exon).</li>
<li>Need to specify the annotation informatyion (.gtf file) 
You can process all the samples at once:</li>
</ul>
<div class="admonition terminal">
<p class="admonition-title">script</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/scripting_workshop/rna_seq
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>$<span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>Subread/2.0.0-GCC-9.2.0
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a>$<span class="w"> </span><span class="nb">pwd</span>
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a>/home/<span class="o">[</span>Your_Username<span class="o">]</span>/scripting_workshop/rna_seq
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a>
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a>$<span class="w"> </span>mkdir<span class="w"> </span>Counts
<a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>Counts
<a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a>
<a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a>$<span class="w"> </span>featureCounts<span class="w"> </span>-a<span class="w"> </span>../ref_genome/Saccharomyces_cerevisiae.R64-1-1.99.gtf<span class="w"> </span>-o<span class="w"> </span>./yeast_counts.txt<span class="w"> </span>-T<span class="w"> </span><span class="m">2</span><span class="w"> </span>-t<span class="w"> </span>exon<span class="w"> </span>-g<span class="w"> </span>gene_id<span class="w"> </span>../Mapping/*sorted.bam
</code></pre></div>
</div>
<div class="admonition abstract">
<p class="admonition-title"><strong>Arguments:</strong></p>
<ul>
<li><strong>-a</strong> Name of an annotation file. GTF/GFF format by default</li>
<li><strong>-o</strong> Name of output file including read counts</li>
<li><strong>-T</strong> Specify the number of threads/CPUs used for mapping. 1 by default</li>
<li><strong>-t</strong> Specify feature type in GTF annotation. 'exon' by default. Features used for read counting will be extracted from annotation using the provided value.</li>
<li><strong>-g</strong> Specify attribute type in GTF annotation. 'gene_id' by default. Meta-features used for read counting will be extracted from annotation using the provided value.</li>
</ul>
</div>
<hr/>
<h2 id="group-exercise">Group Exercise<a class="headerlink" href="#group-exercise" title="Permanent link">¶</a></h2>
<p>Now, let's work together in our groups to create an RNA-seq mapping and count script.</p>
<hr/>
<p>at this stage we have mastered the art of writing scripts, instead of running them on the commandline, let us now run them on HPC.</p>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" hidden="" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Introduction to Bash Scripting and HPC Scheduler is licensed under a <a href="https://opensource.org/license/mit/" rel="noopener" target="_blank">MIT License</a>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top"], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.6df46069.min.js"></script>
<script src="../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>